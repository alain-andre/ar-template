# app/controllers/api/v1/<%= class_name.tableize%>.rb
module API
  module V1
    class <%= class_name.camelize(:upper).pluralize %> < Grape::API
      include API::V1::Defaults 

      helpers do
        # Never trust parameters from the scary internet, only allow the white list through.
        def <%= class_name.underscore %>_params
          params.require(:<%= class_name.underscore %>).permit(<%= @attributes.map { |a| ":#{a.name}" }.join(", ") %>)
        end
      end

      resource :<%= class_name.tableize%> do

        desc "Return list of <%= class_name.tableize%>"
        get do
          <%= class_name.camelize(:upper) %>.all # obviously you never want to call #all here
        end

        desc "Return a <%= class_name.underscore %>."
        params do
          requires :id, type: Integer, desc: "<%= class_name.camelize(:upper) %> id."
        end
        route_param :id do
          get do
            <%= class_name.camelize(:upper) %>.find(params[:id])
          end
        end

        desc "Create a <%= class_name.underscore %>."
        params do # Select required fields
        <%- for attribute in @attributes -%>
          # requires :<%= attribute.name %>, type: <%= attribute.type.camelize(:upper) %>, desc: "Your required <%= attribute.name %>."
        <%- end -%>
        end
        post do
          admin!
          <%= class_name.camelize(:upper) %>.
            create!(<%= class_name.underscore %>_params)
        end

        desc "Update a <%= class_name.underscore %>."
        params do
          requires :id, type: String, desc: "<%= class_name.camelize(:upper) %> ID."
        <%- for attribute in @attributes -%>
          # requires :<%= attribute.name %>, type: <%= attribute.type.camelize(:upper) %>, desc: "Your required <%= attribute.name %>."
        <%- end -%>
        end
        put ':id' do
          admin!
          current_user.<%= class_name.tableize%>.find(params[:id]).
            update(<%= class_name.underscore %>_params)
        end

        desc "Delete a <%= class_name.underscore %>."
        params do
          requires :id, type: String, desc: "<%= class_name.camelize(:upper) %> ID."
        end
        delete ':id' do
          admin!
          current_user.<%= class_name.tableize%>.find(params[:id]).destroy
        end

      end
    end
  end
end